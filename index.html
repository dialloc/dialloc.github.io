	    
maven:release:
  stage: release
  environment: release
  before_script:
    - if [ -z "${tag}" ]; then exit 0; fi 
    - echo "Extracting tag..."
    - echo "TAG=$tag"
    - apt-get update -qq && apt-get install -y -qq git    
    - git config --global user.email "invengo-releaser@invengo.com"
    - git config --global user.name "invengo-releaser"
    - git for-each-ref --format '%(refname:short)' refs/heads/release/ | grep -v master || true
    - git for-each-ref --format '%(refname:short)' refs/heads/release/ | grep -v master | xargs git branch -D || true
    - git branch -D release/$tag || true
    - git branch -D origin/release/$tag || true
    - git fetch
    - git checkout master
    - git pull
    - git checkout develop
    - git pull
    - git reset --hard origin/develop
  script:
    - eval $(aws ecr get-login --region eu-central-1 --no-include-email)
    - mvn $MAVEN_CLI_OPTS jgitflow:release-start jgitflow:release-finish -DreleaseVersion=${tag} -Pdocker		
			<plugin>
				<groupId>external.atlassian.jgitflow</groupId>
				<artifactId>jgitflow-maven-plugin</artifactId>
				<version>1.0-m5.1</version>
				<configuration>
					<allowSnapshots>false</allowSnapshots>
					<allowUntracked>true</allowUntracked>
					<autoVersionSubmodules>true</autoVersionSubmodules>
					<alwaysUpdateOrigin>true</alwaysUpdateOrigin>
					<pushReleases>true</pushReleases>
					<squash>false</squash>
					<scmCommentSuffix> [skip ci]</scmCommentSuffix>
					<flowInitContext>
						<masterBranchName>master</masterBranchName>
						<developBranchName>develop</developBranchName>
						<featureBranchPrefix>feature/</featureBranchPrefix>
						<releaseBranchPrefix>release/</releaseBranchPrefix>
						<hotfixBranchPrefix>hotfix/</hotfixBranchPrefix>
						<versionTagPrefix />
					</flowInitContext>
					<username>XXXXX</username>
					<password>XXXXX</password>
				</configuration>
			</plugin>
